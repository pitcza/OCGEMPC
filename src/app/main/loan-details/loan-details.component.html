<div class="main-overlay">
  <div class="loan-details-container">
    <div class="modal-header">
      <h2>Loan Details</h2>
      <button class="close-button" (click)="closeModal()" aria-label="Close">
        &times;
      </button>
    </div>

    <div class="loan-content" *ngIf="!loading && !error">
      <!-- First Row: Loan Information (Full Width) -->
      <div class="loan-info-section full-width">
        <h3>Loan Information</h3>
        <div class="loan-info-grid">
          <div class="detail-row">
            <span class="detail-label">Loan Type:</span>
            <span class="detail-value">{{ loanDetails?.loan_type }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Amount:</span>
            <span class="detail-value">{{ loanDetails?.applied_amount | currency }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Term:</span>
            <span class="detail-value">{{ loanDetails?.loan_term }} months</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Purpose:</span>
            <span class="detail-value">{{ loanDetails?.loan_purpose }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Repayment Frequency:</span>
            <span class="detail-value">{{ loanDetails?.repayment_freq }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Status:</span>
            <span class="detail-value status-badge" [ngClass]="getStatusClass(loanDetails?.loan_status)">
              {{ loanDetails?.loan_status }}
            </span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Date Applied:</span>
            <span class="detail-value">{{ formatDate(loanDetails?.createdAt) }}</span>
          </div>
        </div>
      </div>

      <!-- Second Row: Maker and Co-maker Details (Two Columns) -->
      <div class="person-details-row">
        <!-- Maker Column -->
        <div class="person-column">
          <div class="details-section">
            <h3>Maker Details</h3>
            <div class="detail-row">
              <span class="detail-label">Name:</span>
              <span class="detail-value">
                {{ makerDetails?.first_name }} 
                {{ makerDetails?.middle_name }} 
                {{ makerDetails?.last_name }}
                {{ makerDetails?.ext_name || '' }}
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Address:</span>
              <span class="detail-value">{{ makerDetails?.address }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Contact:</span>
              <span class="detail-value">{{ makerDetails?.phone_num }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Birthdate:</span>
              <span class="detail-value">{{ formatDate(makerDetails?.birthdate) }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Department:</span>
              <span class="detail-value">{{ makerDetails?.dept }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Position:</span>
              <span class="detail-value">{{ makerDetails?.position }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Salary:</span>
              <span class="detail-value">{{ makerDetails?.salary | currency }}</span>
            </div>
          </div>
        </div>

        <!-- Co-maker Column -->
        <div class="person-column" *ngIf="comakerDetails">
          <div class="details-section">
            <h3>Co-maker Details</h3>
            <div class="detail-row">
              <span class="detail-label">Name:</span>
              <span class="detail-value">
                {{ comakerDetails.co_first_name }} 
                {{ comakerDetails.co_middle_name }} 
                {{ comakerDetails.co_last_name }}
                {{ comakerDetails.co_ext_name || '' }}
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Address:</span>
              <span class="detail-value">{{ comakerDetails.co_address }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Contact:</span>
              <span class="detail-value">{{ comakerDetails.co_phone_num }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Birthdate:</span>
              <span class="detail-value">{{ formatDate(comakerDetails.co_birthdate) }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Department:</span>
              <span class="detail-value">{{ comakerDetails.co_dept }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Position:</span>
              <span class="detail-value">{{ comakerDetails.co_position }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Salary:</span>
              <span class="detail-value">{{ comakerDetails.co_salary | currency }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Third Row: Amortization Schedule (Full Width) -->
      <div class="amortization-section full-width">
        <h3>Amortization Schedule</h3>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Due Date</th>
                <th>Principal</th>
                <th>Interest</th>
                <th>Total Payment</th>
                <th>Remaining Balance</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of amortizationSchedule">
                <td>{{ item.installment_no }}</td>
                <td>{{ formatDate(item.due_date) }}</td>
                <td>{{ item.principal | currency }}</td>
                <td>{{ item.interest | currency }}</td>
                <td>{{ item.total_payment | currency }}</td>
                <td>{{ item.remaining_balance | currency }}</td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusClass(item.status)">
                    {{ item.status || 'unpaid' }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Loading and Error States -->
    <div class="loading-state" *ngIf="loading">
      <div class="spinner"></div>
      <p>Loading loan details...</p>
    </div>
    
    <div class="error-state" *ngIf="error && !loading">
      <p class="error-message">{{ error }}</p>
      <button class="retry-button" (click)="fetchLoanDetails(data.loanId)">Retry</button>
    </div>
  </div>
</div>